Title Автор програми Бездітко О. М.
.686                         ; Директива визначення типу мікропроцесора
.mmx                       ; Директива визначення команд розширення
.model flat,stdcall   ; Завдання лінійної моделі пам’яті та угоди ОС Windows 
option casemap:none                         ;Відмінність малих та великих літер
ExitProcess proto:dword                  ;Прототип АРІ-функції
include\masm32\include\kernel32.inc      ;Виклик 
include\masm32\include\user32.inc         ;бібліотек
include\masm32\include\windows.inc     ;файлів,
includelib \masm32\lib\kernel32.lib           ;які знаходяться 
includelib \masm32\lib\user32.lib              ;в пакеті 
includelib \masm32\lib\windows.lib          ;мови masm32
.data                                                                     ;Директива визначення сегменту даних
titt db "                            КОМП'ЮТЕРНІ СИСТЕМИ ",0 ;Назва першого 
titd db "                                   КУРСОВИЙ ПРОЕКТ   ",0  ;та другого вікна
;CTL  dd 0, 0,127,127,128,255,255,250   ;Початковий стан CTL, CTH 
;CTH  dd 0, 128,0,128,255,128,255, 126   ;в розпакованому форматі
CTL  dd  127,127,128,255,255,255,255,250           ;Початковий стан CTL                 ;
CTH  dd  000,128,255,128,255,128,255,126   ;в розпакованому форматі
len equ ($-CTH)/4                                               ;Кількість подвійних слів в пам’яті
CTLM  db  len dup (?)                                       ;Початковий стан CTL, CTH 
CTHM  db  len dup (?)                                       ;в пакованому форматі 
leb equ  $-CTHM                                                ;Кількість  байтів в пам’яті 
CTW dd  len dup (?)                                          ;Буфер розпакованого та  
CTWM db  leb dup (?)                                       ;пакованого результату станів
buf dd ?,0                                                            ;Буфер повідомлення у першому
bub dd ?,0                                                           ;та другому вікні
infm  db "Стан об’єкта до обробки в мультимедійних пристроях" , 0dh,0ah,0dh,0ah,
"CTL  =  ",len dup (" %d     "), 0dh,0ah, "CTH  =  ",len dup (" %d     "), 0dh,0ah,0dh,0ah,
"                                                       Керівник Бездітко О.М.",0   ;Повідомлення у першому вікні
infb db "Стан об’єкта після обробки в мультимедійних пристроях" ,  0dh,0ah,0dh,0ah,"CTW  = ",
len dup (" %d     "),  0dh,0ah,0dh,0ah,
"                                                     Студентка Козловцев М. Є.",0       ;Повідомлення у другому вікні
pacc macro adr1,adr2 ; Макровизначення паковки подвійних слів в байти
mov ecx,len                    ;Ініціалізація лічильника подвійних слів 
lea esi,adr1                     ;та покажчиків адреси 
lea edi, adr2                    ;даних в пам’яті
.REPEAT          ;Початок директиви перед умовного циклу
mov al, [esi]     ;Передача байту з пам'яті 
mov [edi],al      ;в пам’ять
add esi,4           ;Зміна адрес джерела
add edi,1          ;та приймача
dec ecx             ;Корекція лічильника
.UNTIL ecx==0 ;Завершення директиви перед умовного циклу
Endm                 ;Завершення  директиви макровизначення 
upac macro adrs,adrd             ;Розпаковки байтів в подвійні сліва 
mov ecx,len                                ;Ініціалізація лічильника подвійних слів
lea esi,adrs                                 ;та покажчиків адреси
lea edi, adrd                               ;даних в пам’яті
.WHILE ecx!=0       ;Початок директиви після умовного циклу
 mov al, [esi]             ;Передача байту з пам'яті
mov [edi],al              ; в пам’ять
and dword ptr [edi], 000000ffh ;Скидання в ноль трьох байтів
add esi,1  ;Зміна адрес джерела
add edi,4  ;та приймача
dec ecx     ;Корекція лічильника
.ENDW                        ;Завершення  директиви макровизначення 
endm
.code                           ;Директива визначення початку сегмента програми          
_st:                               ;Мітка початку програми з іменем _st
pacc [CTL], [CTLM]  ;Паковка подвійних слів в байти 
pacc [CTH], [CTHM]  ;масивів операндів
call  PADD1                 ;Виклик процедури обчислення в ММХ розширенні                           
upac [CTWM], [CTW] ;Розпаковка байтів в подвійні слова 
invoke wsprintf,\ ;АРІ функція перетворення чисел
ADDR buf,\         ;Адреса буфера, куди буде записана послідовність чисел
ADDR infm,\       ;Адреса рядка символів, які перетворюються
CTL[28],CTL[24],CTL[20],CTL[16],CTL[12],CTL[8],CTL[4],CTL,\
CTH[28],CTH[24],CTH[20],CTH[16],CTH[12],CTH[8],CTH[4],CTH;Комірки
invoke MessageBox,NULL,\ ;АРІ функція виведення спрощеного вікна 
addr buf, \;Адреса послідовність чисел
addr titt,\ ;Адреса заголовка вікна
MB_ICONINFORMATION ;Вигляд першого вікна 
invoke wsprintf, ADDR bub, ADDR infb,\ ;Адреси буфера та рядка   
CTW[28],CTW[24],CTW[20],CTW[16],CTW[12],CTW[8],CTW[4],CTW;Комірк
invoke MessageBox,NULL,addr bub,addr titd,\ ;Адреси чисел та заголовка
MB_ICONINFORMATION ;Вигляд другого вікна 
invoke ExitProcess,0  ;Повернення в OS Windows
PADD1 proc    ;Директива початку процедур обчислення в ММХ розширенні                           
lea esi, CTLM  ;Ініціалізація покажчиків адрес  
lea edi, CTHM  ;операндів пакету 
lea ebx, CTWM ;та результату
emms                                       ;Збудження ММХ розширення 
movq MM0, qword ptr [esi] ;Передача пакету першого операнду
movq MM1, qword ptr [edi] ;Передача пакету другого операнду
;paddb MM0,MM1                  ;Пакетне додавання байтів 
;paddusb MM0,MM1             ;Пакетне додавання байтів з без знаковим насиченням
;paddsb MM0,MM1                ;Пакетне додавання байтів зі знаковим насиченням
;psubb MM0,MM1                  ;Пакетне віднімання байтів
psubusb MM0,MM1               ;Пакетне віднімання байтів з без знаковим насиченням
;psubsb MM0,MM1                ;Пакетне віднімання байтів зі знаковим насиченням
movq  qword ptr [ebx], MM0 ;Збереження пакету результату
ret                                               ;Повернення з процедури
PADD1 endp                             ;Директива закінчення процедур                            
end _st                                       ;Закінчення програми з іменем  _st 

